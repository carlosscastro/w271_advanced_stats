---
title: "Statistical Methods for Discrete Response, Time Series, and Panel Data (W271): Lab 1"
author: "Eric Yang, Samir Datta, Carlos Castro"
date: "September 30, 2017"
output: pdf_document
---

# Lab Instructions:

*  **Due Date: 10/01/2017 11:59 PM PT**

* Submission:
    * Submit your own assignment via ISVC
    * Submit 2 files:
        1. A pdf file including the summary, the details of your analysis, and all the R codes used to produce the analysis. Please do not suppress the codes in your pdf file.
        2. R markdown file used to produce the pdf file
    * Each group only needs to submit one set of files
    * Use the following file naming convensation; fail to do so will receive 10% reduction in the grade:
        * SectionNumber_hw01_FirstNameLastNameFirstInitial.fileExtension
        * For example, if you are in Section 1 and have two students named John Smith and Jane Doe, you should name your file the following
            * Section1_hw01_JohnS_JaneD.Rmd
            * Section1_hw01_JohnS_JaneD.pdf
    * Although it sounds obvious, please write the name of each members of your group on page 1 of your report.
    * This lab can be completed in a group of up to 3 people. Each group only needs to make one submission. Although you can work by yourself, we encourage you to work in a group.
    * When working in a group, do not use the "division-of-labor" approach to complete the lab. That is, do not divide the lab by having Student 1 completed questions 1 - 3, Student 2 completed questions 4 - 6, etc. Asking your teammates to do the questions for you is asking them take away your own opportunity to learn.

* Other general guidelines:
    * If you use R libraries and/or functions to conduct hypothesis tests not covered in this course, you will have to explain why the functions you use are appropriate for the hypothesis you are asked to test. Lacking explanations will result in a score of zero for the corresponding question.
  
    * Thoroughly analyze the given dataset. Detect any anomalies, including missing values, potential of top and/or bottom code, etc, in each of the variables.
    
    * Your report needs to include a comprehensive Exploratory Data Analysis (EDA) analysis, which includes both graphical and tabular analysis, as taught in this course. Output-dump (that is, graphs and tables that don't come with explanations) will result in a very low, if not zero, score.
    
    * Your analysis needs to be accompanied by detailed narrative. Remember, make sure your that when your audience (in this case, the professors and your classmates) can easily understand your your main conclusion and follow your the logic of your analysis. Note that just printing a bunch of graphs and model results, which we call "output dump", will likely receive a very low score.
    
    * Your rationale of any decisions made in your modeling needs to be explained and supported with empirical evidence. Remember to use the insights generated from your EDA step to guide your modeling step, as we discussed in live sessions.
    
    * All the steps to arrive at your final model need to be shown and explained very clearly.

*  Students are expected to act with regards to UC Berkeley Academic Integrity.


# Description of the Business Problem and the Data

Imagine you work in a data science consulting company. Your client is interested in selling T-shirts to voters who are likely to support politically liberal candidates (such as Bernie Sanders). Your client has data from a political survey conducted in January of 2016 and is able to identify voters who preferred Bernie Sanders over Hillary Clinton (1 = Likes Bernie more than Clinton; 0 = Likes Clinton more than Bernie). In addition, this (extremely simple) dataset contains information on respondents': 

- Party affiliation (1 if Democrat , 2 if Independent or Other, and 3 if Republican); 

- Race (1 if white, 0 otherwise); 

- Gender (2 if female, 1 if male);

- and Birthyear. 

Your client conducted a t-test and found that younger voters were more likely to support Sanders and is willing to target younger voters/shoppers based on this analysis. He thinks that you can do better.

For reference, the United States is considered a two party system. The Democratic Party tends to be associated with politically liberal polices while the Republican Party tends to be associated with politically conservative ideas. Voters are not required to be associated with these two parties and, as you will see later, a high proportion of voters are not associated with these two parties.

Note: This dataset is modified from the 2016 American National Election Survey.


\newpage

1. Model the relationship between age and voters' preference for Bernie Sanders over Hillary Clinton. Select the model that you prefer the most and describe why you chose these variables and functional form. 

    a. Describe your chosen model in words, along with a brief description of the variables and the model's functional form (*Note: You do not have to justify your choices at this step*).

    b. Describe the variables your have included in your model and justify why you chose these variables and the model's functional form. (*Hint: you will have to conduct a very careful EDA and use insights generated from the EDA to support your modeling decision. DO NOT USE OUTPUT-DUMP, meaning do not just print a bunch of graphs and let us interpret the graphs for you. Choose your graphs/tables very selectively and present them with narratives to suppor your modeling decisions.*)

    c. Based on your EDA, describe other models that you might have considered and why you ended up choosing your final model. Be sure to print each of the model results and any statistical tests you used to choose which model to use.

    d. Print the model results of your chosen model, even if you did so earlier.

    e. Conduct all of the relevant statistical tests on your chosen model.

    f. Interpret the impact of age on the dependent variable using odds ratios and be sure to include confidence intervals.


2. For your chosen model, graph the relationship between age and the predicted probabilty of supporting Sanders. Be sure to include any graphs that helps you understand how your model can help you answer the question at hand.

3. Comment on the importance of age and evaluate your client's decision to target younger voters.


\newpage

```{r}
library(ggplot2)
theme_set(theme_bw())
library(car)
publicopinion <- read.csv('public_opinion.csv')

publicopinion$partyfactor <- ifelse(publicopinion$party==1, 'Democrat', 
                                    ifelse(publicopinion$party==2, 'Other', 
                                           'Republican'))

publicopinion$age <- 2017 - publicopinion$birthyr
publicopinion$genderfactor <- ifelse(publicopinion$gender==1,'Male', 'Female')
publicopinion$racefactor <- ifelse(publicopinion$race_white==1, 'White', 'Non-White')
publicopinion$spfactor <- ifelse(publicopinion$sanders_preference==1, "Yes", "No")
publicopinion_narm <- publicopinion[!is.na(publicopinion$sanders_preference),]
```

# 1.a Model
Model Overview
The model looks at the likelihood of supporting bernie sanders based on 4 explanatory variables. The three explantory variables are age as of 2017, race_white (non white vs. white), independent voter (baseline democrat), republican (baseline democrat).  

Age
The age variable was caculated as of 2017 based off the birth year variable in the original dataset. Age has a negative coefficient which is statistically significant showing that an increase in age reduces the likelihood of supporting sanders.  The odds_age object shows that for every 10 years decrease in age we see a ~1.13 increase in the odds of supporting sanders. 

Racefactor
Racefactor = 0 is non white, race_white = 1 is white. Racefator has a positive coefficient in our model that is statistically significant.  Looking at the odds ratios we see that being white increases odds of supporting sanders by 2.39 holding all other variables constant.  

Partyfactor
Both the independent and republican variables have statistically significant positive coefficients.  This shows that have either party affiliation versus democrat would increase the probability of supporting sanders.  A look at the odds ratio shows an odds increase of 2.04 for independents and 1.81 for republicans. 

```{r}
#Section 1a.
model.final <- glm(sanders_preference ~ age + racefactor + partyfactor, data = publicopinion, family = binomial(link = logit))

summary(model.final)

odds_age <- exp(model.final$coefficients[2]*-10)
odds_age

odds_white<- exp(model.final$coefficients[3])
odds_white

odds_ind <- exp(model.final$coefficients[4])
odds_ind

odds_rep <- exp(model.final$coefficients[5])
odds_rep
```
# 1.b EDA

## Age

## Party

## Race

## Gender

# 1.c Alternate models

In our EDA, we determined that race and party had large effects on Sanders preference and would be important to control for. Gender did not seem like it had much explanatory power on its own, although a gender by age interaction seemed plausible. A race by age interacton also looked to be worth testing. Finally, we wanted to test the plausability of a quadratic age term.

###Gender by age interaction

```{r}
glm.out.base <- glm(sanders_preference ~ age + partyfactor + racefactor + 
                 genderfactor, data=publicopinion_narm,
                 family=binomial(link='logit'))
glm.out.int <- glm(sanders_preference ~ age + partyfactor + racefactor + 
                 genderfactor + age:genderfactor, data=publicopinion_narm,
                 family=binomial(link='logit'))

summary(glm.out.base)
```
```{r}
summary(glm.out.int)
```

```{r}
anova(glm.out.base, glm.out.int, test="LR")
```

We noticed that the statistical significance of the age term got slightly stronger in the interaction model than in the base model. In the base model, the coefficient for age represented the relationship between age and Sanders preference across the sampl. In the interaction model, it represents the relationship for the base level of gender only, which is female. The coefficient of the interaction term is .011, which means the coefficient for age in males only would be -.018 + .011 = -.007. We can interpret this to mean that the model is suggesting there is a strong negative relationship for female voters but not male voters.

We have decided against this model for a few reasons. First of all, we know from looking at the data and at both models that the effect of gender is very small. Second of all, the p-values given to the interaction term and the likelihood ratio test are not statistically significant even at p < 0.1. This tells us that although there may be a hint of a gender interaction term it isn't strong enough to justify including it in our final model.

###Party by age interaction

```{r}
glm.out.base <- glm(sanders_preference ~ age + partyfactor + racefactor + 
                 genderfactor, data=publicopinion_narm,
                 family=binomial(link='logit'))
glm.out.int <- glm(sanders_preference ~ age + partyfactor + racefactor + 
                 genderfactor + age:partyfactor, data=publicopinion_narm,
                 family=binomial(link='logit'))

summary(glm.out.base)
```
```{r}
summary(glm.out.int)
```

There are a number of reasons that modeling an age by party interaction does not seem like a good idea. First of all, neither of the interacton terms (age:Other, age:Republican) have large effects. Their coefficients are relatively small compared to the original coefficient of the age term, and their p-values are nowhere near statistical significance (p > .33). The AIC for the model with the interaction term is larger than for the model without it, suggesting that our additional model complexity is not helping the overall model.

```{r}
anova(glm.out.base, glm.out.int, test="LR")
```

The likelihood ratio test, with a p-value of .53, also suggests our interaction model is not more useful than the simpler model. For these reasons we decided to not model an age by party interaction.

###Quadratic age term

```{r}
glm.out.base <- glm(sanders_preference ~ age + partyfactor + racefactor + 
                 genderfactor, data=publicopinion_narm,
                 family=binomial(link='logit'))
glm.out.quad <- glm(sanders_preference ~ age + partyfactor + racefactor + 
                 genderfactor + I(age^2), data=publicopinion_narm,
                 family=binomial(link='logit'))

summary(glm.out.base)
```

```{r}
summary(glm.out.quad)
```

```{r}
anova(glm.out.base, glm.out.quad, test="LR")
```

Like the EDA showed, the model is showing that a quadratic age term might be plausible. The significance of the term in the model is slightly larger than .05 (.06), as is the signifiance of the likelihood ratio test (.06). The AIC of the model with the quadratic term is also lower.

However, we decided to not to include the quadratic age term in the end. Aside from the lack of statistical significance - although it is close - the main reason for this is the lack of representation in the older age range that is driving this result. We would not feel comfortable recommending this model and suggesting that older voters be targeted when we have so few older people that are contributing to this trend.

# 1.d Selected model results

# 1.e Statistical Tests

# 1.f Age Impact Interpretation

# 2 Plot: Age vs Predicted probability of supporting Sanders

# 3 Comment on Importance of Age and Client recommendation

